enum Modulos {
    RAMAL
    REGRA
    TRONCO
    FILA
    GRUPO_DE_CAPTURA
    USUARIO
    RELATORIO
    SISTEMA
}

enum LogActions {
    LOGIN
    LOGOUT
    CRIAR
    EDITAR
    DELETAR
}

enum LogStatus {
    TENTATIVA
    SUCESSO
    FALHA
}

model Usuario {
    id String @id @default(uuid()) @db.Uuid
    nome String @db.VarChar(255)
    email String @db.VarChar(255) @unique
    senha String @db.VarChar(255)
    is_admin Boolean @default(false)
    perfil_id String? @db.Uuid
    last_login DateTime?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    perfil Perfil? @relation(fields: [perfil_id], references: [id], onDelete: SetNull)
    permissoesUsuario PermissaoUsuario[]
    logs Log[]

    @@index([id], map: "usuario_id")
    @@index([email], map: "usuario_email")
    @@index([perfil_id], map: "usuario_perfil_id")
    @@index([last_login], map: "usuario_last_login")

    @@map("usuarios")
}

model Perfil {
    id String @id @default(uuid()) @db.Uuid
    nome String @db.VarChar(255) @unique
    descricao String? @db.VarChar(255)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    usuarios Usuario[]
    permissoes PermissaoPerfil[]

    @@index([id], map: "perfil_id")
    @@index([nome], map: "perfil_nome")

    @@map("perfis")
}

model PermissaoPerfil {
    id String @id @default(uuid()) @db.Uuid
    modulo Modulos
    perfil_id String @db.Uuid
    criar Boolean @default(true)
    ler Boolean @default(true)
    editar Boolean @default(true)
    deletar Boolean @default(true)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    perfil Perfil @relation(fields: [perfil_id], references: [id], onDelete: Cascade)

    @@index([id], map: "permissao_id")
    @@index([modulo], map: "permissao_modulo")
    @@index([perfil_id], map: "permissao_perfil_id")
    @@index([criar], map: "permissao_perfil_criar")
    @@index([ler], map: "permissao_perfil_ler")
    @@index([editar], map: "permissao_perfil_editar")
    @@index([deletar], map: "permissao_perfil_deletar")

    @@map("permissao_perfis")
}

model PermissaoUsuario {
    id String @id @default(uuid()) @db.Uuid
    modulo Modulos
    usuario_id String @db.Uuid
    criar Boolean @default(true)
    ler Boolean @default(true)
    editar Boolean @default(true)
    deletar Boolean @default(true)
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    usuario Usuario @relation(fields: [usuario_id], references: [id], onDelete: Cascade)

    @@index([id], map: "permissao_usuario_id")
    @@index([modulo], map: "permissao_usuario_modulo")
    @@index([usuario_id], map: "permissao_usuario_usuario_id")
    @@index([criar], map: "permissao_usuario_criar")
    @@index([ler], map: "permissao_usuario_ler")
    @@index([editar], map: "permissao_usuario_editar")
    @@index([deletar], map: "permissao_usuario_deletar")

    @@map("permissao_usuarios")
}

model Log {
    id String @id @default(uuid()) @db.Uuid
    usuario_id String? @db.Uuid
    ip String @db.VarChar(255)
    status LogStatus
    acao LogActions
    modulo Modulos?
    metaData Json?
    createdAt DateTime @default(now())
    updatedAt DateTime @updatedAt

    usuario Usuario? @relation(fields: [usuario_id], references: [id], onDelete: SetNull)

    @@index([id], map: "logs_id")
    @@index([usuario_id], map: "logs_usuario_id")
    @@index([status], map: "logs_status")
    @@index([acao], map: "logs_acao")
    @@index([modulo], map: "logs_modulo")
    @@index([ip], map: "logs_ip")

    @@map("logs")
}